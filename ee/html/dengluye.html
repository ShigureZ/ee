<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style type="text/css">
        body {
            background: white;
        }

        .head {
            width: 100%;
            height: 1.5rem;
            top: 1.75rem;
            position: absolute;
        }

        .text1 {
            width: 9%;
            height: 1.1rem;
            font-family: '微软雅黑';
            font-size: 0.8rem;
            float: left;
            margin-left: 0.75rem
        }

        .text2 {
            width: 9%;
            height: 1.1rem;
            font-family: '微软雅黑';
            font-size: 0.8rem;
            float: right;
            margin-right: 0.75rem
        }

        .aui-list-item-input {
            margin-left: 15px;
            border-bottom: 1px solid #f2f2f2;
        }

        .tubiao {
            width: 21.3%;
            height: 4rem;
            margin: 4.5rem auto;
        }

        .tubiao i {
            display: block;
            text-align: center;
            font-style: normal;
            font-size: 3.3rem;
            font-family: 'Ravie';
            color: white;
        }

        .aui-list-item-inner {
            text-align: center;
        }

        .input {
            font-size: 13px;
        }

        .button {
            width: 76%;
            height: 2rem;
            padding-top: 0.5rem;
            background: #48b9fd;
            margin: auto;
            margin-top: 6rem;
            border-radius: 0.3rem;
        }

        .button i {
            display: block;
            font-family: '微软雅黑';
            font-size: 0.8rem;
            font-style: normal;
            color: white;
            text-align: center;
        }

        .text-area3 {
            width: 19.5%;
            height: 1rem;
            margin: auto;
            margin-top: 3rem;
            font-family: '微软雅黑';
            font-size: 0.7rem;
            color: #48b9fd;
        }
    </style>
</head>

<body>
    <div class="head">
        <div class="text1">关闭</div>
        <div class="text2" onclick="zhuce()">注册</div>
    </div>
    <div class="tubiao">
        <img src="../image/Ee.png" alt="">
    </div>
    <ul>
        <li class="aui-list-item">
            <div class="aui-list-item-inner">
                <div class="aui-list-item-input">
                    <input class="input" type="text" placeholder="手机号" id="username" value="">
                </div>
            </div>
        </li>
        <li class="aui-list-item">
            <div class="aui-list-item-inner">
                <div class="aui-list-item-input">
                    <input class="input" type="password" placeholder="密码" id="password" value="">
                </div>
            </div>
        </li>
    </ul>
    <div class="button" onclick="login()">
        <i>登录</i>
    </div>
    <div class="text-area3">忘记密码?</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/APICloud-rest-SHA1.js"></script>
<script type="text/javascript" src="../script/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
    apiready = function() {
      var username = $api.getStorage('username');
      var password = $api.getStorage('password');
       if(username && password)
             autoLogin(username,password);
    };

    function zhuce() {
        api.openWin({
            name: 'zhuceye',
            url: './zhuceye.html',
            pageParam: {
                name: 'test'
            }
        });

    }

    function login() {
        var username = $("#username").val();
        var password = $("#password").val();
        //获取用户信息
        var userInfo=$api.getStorage('user_info');
        autoLogin(username,password);
        // alert(username + "--" + password);
      }

    function autoLogin(username,password) {
        var client = new Resource("A6076425356783", "751FE5FD-0553-E755-CB71-4B935B5E8B84");
        var Model = client.Factory("user"); //表名称
        Model.login({
                "username": username,
                "password": password
            },
            function(ret, err) {
                if (err) {
                    //处理错误 err
                    // alert(JSON.stringify(err)) //讲json对象转换成字符串
                } else {
                    //处理数据 ret
                    // alert(JSON.stringify(ret))
                    // alert(ret.userId);

                    Model.get({
                        "_id": ret.userId
                    }, function(ret, err) {
                        if (err) {
                            //处理错误 err
                            // alert(JSON.stringify(err))
                        } else {
                            //处理数据 ret
                            // alert(JSON.stringify(ret))
                            $api.setStorage('username', username);
                            $api.setStorage('password', password);
                            $api.setStorage('user_info', ret);
                            api.openWin({
                                name: 'rxd_wanted',
                                url: './rxd_wanted.html',
                                pageParam: {
                                    name: 'test'
                                }
                            });

                        }
                    })
                    // 以上model.get方法
                }
            })
// 以上model.login登录

    }
</script>

</html>
